@@include('parts/header.html')

<title>Telegram</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@600&display=swap" rel="stylesheet">

<div class="contact-block">

    <button class="contact-button">
        <div class="contact-icon" style="background-color: #b02654"></div>
        <div class="contact-name">Арбуз Арсеньевич</div>
        <div class="contact-last-msg"></div>
    </button>

</div>

<div class="chat-block">

    <div class="chat-upper-line">
        <div class = "chat-upper-line-name">Арбуз Арсеньевич</div>
    </div>

    <div class="chat-text-block">

    </div>

    <form name="chat-msg-input">
        <input class="chat-msg-input" name="msg-area" placeholder="Введите сообщение" type="text" size="20">
        <input class="chat-msg-submit" onclick="sendMessage()" name="msg-submit" type="button" value="Отправить сообщение">
    </form>
</div>

<script>
    displayDialog();

    function displayDialog() {
        for (let i = 0; i < localStorage.length; i++) {
            addMessage(localStorage.getItem(i.toString()));
        }
        changeLastMessage(localStorage.getItem((localStorage.length - 1).toString()));
    }

    function sendMessage() {
        const msg = document.querySelector('input.chat-msg-input');
        if (msg.value.length > 0)
        {
            addMessage(msg.value);

            localStorage.setItem(localStorage.length.toString(), msg.value);
            changeLastMessage(localStorage.getItem((localStorage.length - 1).toString()));

            msg.value = '';
        }
    }

    function addMessage(text) {
        const chatTextBlock = document.querySelector('.chat-text-block');
        const node = document.createElement('div');
        node.className = "chat-message";
        node.insertAdjacentText("afterbegin", text);
        chatTextBlock.append(node);
    }

    function changeLastMessage(text) {
        const contactButton = document.querySelector('.contact-button')
        const lastMessage = document.querySelector('.contact-last-msg');
        lastMessage.textContent = text;
    }
</script>

@@include('parts/footer.html')